{% extends "base.html" %}
{% block main_class %}full-width{% endblock %}
{% block content %}

<div class="dashboard-wrapper">

  <!-- LEFT SIDEBAR -->

  <!-- MAIN CONTENT -->
  <main class="dashboard-main">

    <!-- TOP SUMMARY CARDS -->
    <section class="summary-cards">

      <!-- YOU WILL GET -->
      <div class="card ledger-card positive-card">
        <div class="card-header">
          <span class="label">You Will Get</span>
          <span class="icon">‚Üó</span>
        </div>
        <div class="card-amount">
          {% set gets = people_balances | selectattr("amount", "gt", 0) | list %}
          {% set total_get = gets | map(attribute="amount") | sum %}
          ‚Çπ{{ total_get }}
        </div>
      </div>

      <!-- YOU OWE -->
      <div class="card ledger-card negative-card">
        <div class="card-header">
          <span class="label">You Owe</span>
          <span class="icon">‚Üô</span>
        </div>
        <div class="card-amount">
          {% set owes = people_balances | selectattr("amount", "lt", 0) | list %}
          {% set total_owe = owes | map(attribute="amount") | sum | abs %}
          ‚Çπ{{ total_owe }}
        </div>

        {% if total_owe > 0 %}
        <div class="urgency-tag">
          ‚ö†Ô∏è Settlements pending
        </div>
        {% endif %}
      </div>

      <!-- NET POSITION -->
      <div class="card ledger-card neutral-card">
        <div class="card-header">
          <span class="label">Net Position</span>
        </div>
        <div class="card-amount {{ 'positive' if total_balance >= 0 else 'negative' }}">
          {{ '+' if total_balance > 0 else '' }}‚Çπ{{ total_balance }}
        </div>
      </div>

    </section>

    <div class="dashboard-content-grid">

      <!-- RECENT ACTIVITY -->
      <div class="activity-section" id="recent-activity">
        <h3>Recent Activity</h3>

        <div class="activity-feed">
          {% if people_balances %}
          {% for p in people_balances [:4]%}
          <div class="activity-item">

            <div class="activity-icon {{ 'get' if p.amount > 0 else 'owe' }}">
              {{ 'üò∫' if p.amount > 0 else 'üòø' }}
            </div>

            <div class="activity-details">
              <span class="activity-text">
                {% if p.amount > 0 %}
                {{ p.name }} owes you
                <strong>‚Çπ{{ p.amount }}</strong>
                <span class="muted-text">({{ p.group_name }})</span>
                {% else %}
                You owe {{ p.name }}
                <strong>‚Çπ{{ p.amount | abs }}</strong>
                <span class="muted-text">({{ p.group_name }})</span>
                {% endif %}
              </span>

              <span class="activity-time">Pending Balance</span>
            </div>

          </div>
          {% endfor %}
          {% else %}
          <p class="muted-text">No recent activity</p>
          {% endif %}
        </div>
      </div>

      <!-- QUICK ACTIONS -->
      <div class="actions-section">

        <div class="quick-actions-card">
          <h4>Quick Actions</h4>
          <div class="action-buttons">
            <a href="/groups/new" class="btn action-btn primary">
              <span class="plus">+</span> Create Group
            </a>
            <a href="/expenses/new" class="btn action-btn secondary">
              Add Expense
            </a>
            <a href="/settlements/new" class="btn action-btn secondary">
              Settle Up
            </a>
          </div>
        </div>

        <!-- URGENCY ALERT -->
        {% if total_owe > 0 %}
        <div class="alert-card">
          <div class="alert-icon">‚ö†Ô∏è</div>
          <div class="alert-content">
            <strong>Outstanding Debt</strong>
            <p>You owe a total of ‚Çπ{{ total_owe }}. Please settle up soon.</p>
            <div class="alert-meta">Last settlement: 14 days ago</div>
          </div>
        </div>
        {% endif %}

      </div>
    </div>

  </main>
</div>

{% endblock %}